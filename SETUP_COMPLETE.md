# Notebook Setup Complete - Summary

## âœ… Both Notebooks Are Ready!

### 1. data_prep_and_features.ipynb âœ“
**Status:** Fully functional and validated  
**Purpose:** Prepares and processes raw data into ML-ready datasets

**What it does:**
- Loads HarvestStat state-level crop yield data (4 crops: Maize, Rice, Cassava, Yams)
- Aggregates state yields to regional averages (6 geopolitical regions)
- Merges with climate data (Temperature, Rainfall, Humidity, CO2)
- Merges with soil data (pH, Nitrogen, Phosphorus, Organic Matter)
- Creates 3 dataset types:
  * **FNN**: Annual aggregated (384 train, 96 val, 96 test)
  * **LSTM**: Monthly time-series with engineered features (GDD, Cumulative Rainfall, Days Into Season)
  * **Hybrid**: Monthly sequences + static features
- Temporal splits: Train (2000-2015), Val (2016-2019), Test (2020-2023)

**Output files:**
```
project_data/
â”œâ”€â”€ processed_data/
â”‚   â”œâ”€â”€ master_data_fnn.csv
â”‚   â”œâ”€â”€ master_data_lstm.csv
â”‚   â”œâ”€â”€ master_data_hybrid.csv
â”‚   â””â”€â”€ preprocessing_metadata.json
â””â”€â”€ train_test_split/
    â”œâ”€â”€ fnn/ (train.csv, val.csv, test.csv)
    â”œâ”€â”€ lstm/ (train.csv, val.csv, test.csv)
    â””â”€â”€ hybrid/ (train.csv, val.csv, test.csv)
```

### 2. phase3_model_dev.ipynb âœ“
**Status:** Fixed and ready to train models  
**Purpose:** Trains and evaluates 3 deep learning models

**What it does:**
- Loads prepared datasets from project_data/train_test_split/
- Encodes categorical features (Crop, Region) using LabelEncoder
- Trains 3 models:
  * **FNN**: Feedforward Neural Network for annual data
  * **LSTM**: Long Short-Term Memory for monthly sequences
  * **Hybrid**: Combined LSTM + Static features
- All models use classification (Low/Medium/High yield categories)
- Evaluates using accuracy, precision, recall, F1-score
- Saves best model weights to models/

**Key fixes applied:**
- âœ“ Updated header to reflect 4 crops (Maize, Rice, Cassava, Yams) not 5
- âœ“ Added missing paths and feature column definitions
- âœ“ Removed unnecessary yield conversion (works with kg/ha directly)
- âœ“ Added categorical encoding for Crop and Region
- âœ“ Fixed encoder references (crop_encoder, region_encoder)
- âœ“ Cleared all stale cell outputs

## ğŸ“Š Dataset Details

**Crops:** Maize, Rice, Cassava, Yams  
**Regions:** North West, North East, North Central, South West, South East, South South  
**Years:** 2000-2023 (24 years)  
**Splits:** 
- Train: 2000-2015 (16 years, 384 samples for FNN)
- Val: 2016-2019 (4 years, 96 samples for FNN)
- Test: 2020-2023 (4 years, 96 samples for FNN)

**FNN Features (10):**
- Temperature_C, Rainfall_mm, Humidity_percent, CO2_ppm
- Avg_pH, Avg_Nitrogen_ppm, Avg_Phosphorus_ppm, Avg_Organic_Matter_Percent
- Crop_encoded, Region_encoded

**LSTM Features (13):**
- Same climate + soil features
- Plus: GDD, Cumulative_Rainfall, Days_Into_Season, Month
- Plus: Crop_encoded, Region_encoded

**Hybrid Features:**
- Temporal: Climate + engineered features (monthly sequences)
- Static: Soil properties + encodings

## ğŸš€ How to Run

### Option 1: Run Both Notebooks Sequentially
1. Open **data_prep_and_features.ipynb**
   - Kernel â†’ Restart Kernel and Run All Cells
   - Wait ~30-60 seconds for completion
   - Verify: All cells execute without errors

2. Open **phase3_model_dev.ipynb**
   - Kernel â†’ Restart Kernel and Run All Cells
   - Wait ~15-60 minutes (depending on CPU/GPU)
   - Models will train: FNN â†’ LSTM â†’ Hybrid

### Option 2: Run Validation Script
```bash
python validate_notebooks.py
```
This will:
- Check if processed data exists
- Validate data structure  
- Verify phase3 notebook setup
- Provide clear next steps

## ğŸ“ File Structure

```
Final_Year_Project/
â”œâ”€â”€ data_prep_and_features.ipynb   âœ“ Data preparation
â”œâ”€â”€ phase3_model_dev.ipynb          âœ“ Model training
â”œâ”€â”€ validate_notebooks.py           âœ“ Validation script
â”œâ”€â”€ config/
â”‚   â””â”€â”€ regions_and_state.json     (State to region mapping)
â”œâ”€â”€ project_data/
â”‚   â”œâ”€â”€ raw_data/
â”‚   â”‚   â”œâ”€â”€ crop_yield/
â”‚   â”‚   â”‚   â””â”€â”€ adm_crop_production_NG.csv
â”‚   â”‚   â”œâ”€â”€ climate/ (temperature, rainfall, humidity, co2)
â”‚   â”‚   â””â”€â”€ soil/ (nigeria_soil_complete.csv)
â”‚   â”œâ”€â”€ processed_data/             âœ“ Generated by data_prep
â”‚   â”‚   â”œâ”€â”€ master_data_fnn.csv
â”‚   â”‚   â”œâ”€â”€ master_data_lstm.csv
â”‚   â”‚   â”œâ”€â”€ master_data_hybrid.csv
â”‚   â”‚   â””â”€â”€ preprocessing_metadata.json
â”‚   â””â”€â”€ train_test_split/           âœ“ Generated by data_prep
â”‚       â”œâ”€â”€ fnn/ (train, val, test)
â”‚       â”œâ”€â”€ lstm/ (train, val, test)
â”‚       â””â”€â”€ hybrid/ (train, val, test)
â””â”€â”€ models/                         (Will be created by phase3)
    â”œâ”€â”€ fnn_best.weights.h5
    â”œâ”€â”€ fnn_model.keras
    â”œâ”€â”€ lstm_best.weights.h5
    â”œâ”€â”€ lstm_model.keras
    â”œâ”€â”€ hybrid_best.weights.h5
    â””â”€â”€ hybrid_model.keras
```

## ğŸ¯ Expected Results

After running both notebooks successfully:

**data_prep_and_features.ipynb:**
- âœ… 12 CSV files created (3 master + 9 splits)
- âœ… metadata.json with preprocessing info
- âœ… All files validated and readable

**phase3_model_dev.ipynb:**
- âœ… 3 models trained (FNN, LSTM, Hybrid)
- âœ… 6 model files saved (.keras + .weights.h5)
- âœ… Training history plots
- âœ… Confusion matrices
- âœ… Classification metrics (accuracy, precision, recall, F1)

## ğŸ” Troubleshooting

**Issue:** data_prep notebook fails  
**Solution:** Check that raw data files exist in project_data/raw_data/

**Issue:** phase3 notebook can't find data  
**Solution:** Run data_prep notebook first to generate processed files

**Issue:** Out of memory during training  
**Solution:** Reduce batch_size in model training cells (default: 32 â†’ try 16)

**Issue:** Models training too slowly  
**Solution:** Reduce epochs (default: 100 â†’ try 50) or patience (15 â†’ 10)

## âœ¨ Key Achievements

1. âœ… **Correct Continuity**: phase3 now correctly loads data generated by data_prep
2. âœ… **4-Crop Dataset**: Both notebooks use the same 4 crops (Maize, Rice, Cassava, Yams)
3. âœ… **Regional Aggregation**: State-level yields properly aggregated to 6 regions
4. âœ… **Proper Splits**: Temporal splits maintained (no data leakage)
5. âœ… **Clean Pipeline**: data_prep â†’ processed_data/ â†’ phase3 â†’ models/

---

**Last Updated:** January 9, 2026  
**Status:** âœ… Ready for production use
